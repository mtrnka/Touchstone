---
title: "Touchstone: CLMS re-scoring, classification, biological inference and more for Protein Prospector crosslink searches"
output: github_document
bibliography: tstone_readme.bib
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  cache = FALSE
)
```

## Protein Prospector - Touchstone CLMS pipeline

<!-- badges: start -->
<!-- badges: end -->

The Touchstone library exists to improve the functionality of [Protein Prospector](https://prospector.ucsf.edu/prospector/mshome.htm){target="_blank"} for Crosslinking
Mass Spectrometry [@trnka_matching_2014]. Touchstone re-scores Prospector CLMS 
results using an Support Vector Machine (SVM) classifier that does a better 
job discriminating between correct and incorrect crosslinks than the Prospector scores. 

It allows the user to classify datasets at a desired False Discovery Rate (FDR) 
threshold at various summarization levels: Crosslinked Spectral Matches (CSMs), 
Unique Residue Pairs (URPs), or Protein Pairs (PPs). Touchstone's FDR assessment
are highly consistent with error rates measured assessed by various benchmarking
datasets [@beveridge_synthetic_2020; @matzinger_mimicked_2022; @fischer_assessment_2025].

Additionally Touchstone contains features to help with dataset valdiation by 
measuring euclidean distances of crosslinks against high-res structure files, 
or by querying [STRING-db](https://string-db.org/){target="_blank"} for String Scores of 
putative protein interactions.

To aid with biological inference, Touchstone can optionally classify data into 
"Modules" which can designate either domains within a larger polypeptide 
or stable assemblies of multiple polypeptides (or both). There are convenience 
functions to export data to [XiNet](https://crosslinkviewer.org/){target="_blank"} and some 
internal plotting functions for quantitating CSMs across proteins or modules.

Touchstone is an R package that that I developed to address my own needs when 
analyzing CLMS datasets searched with Prospector, as a project scientist supporting 
numerous [projects](https://scholar.google.com/citations?hl=en&user=Gae1r_AAAAAJ&view_op=list_works&sortby=pubdate){target="_blank"} over the last decade or so. It is therefore a bit niche 
and wasn't developed with a wide user base in mind. Nor am I a software developer. 
So, it is rough around the edges. I am sharing it here because it might be 
helpful to some users, but if you are looking for a smooth user experience that 
doesn't require tinkering in R, you might be better served by other CLMS database 
search and re-scoring software.

I am currently only distributing a version here that is run in an R command line
environment, typically in [RStudio](https://posit.co/download/rstudio-desktop/){target="_blank"}. 
A demo version of a graphical interface (built in [Shiny](https://shiny.posit.co/){target="_blank"}) 
exists and is under development for eventual integration with Protein Prospector. 
This will be more accesible to a wider user-base. The eventual goal is to make 
Prospector CLMS searches more widely accessible to the research community.

The graphical demo version can be accessed at [shinyapps.io](https://prospts.shinyapps.io/tstoneapp/){target="_blank"}

Additional instructions for the graphical demo are [here](https://msf.ucsf.edu/mike/crosslinkingClass/dataset_summary.html){target="_blank"}

The rest of this mini-vignette will refer to running Touchstone inside of RStudio.

## Installation

The touchstone library is distributed on [GitHub](https://github.com/){target="_blank"}.
Install with:

``` r
# install.packages("devtools")
devtools::install_github("mtrnka/Touchstone")
```

## 80S Ribosome data acquired by MS2.HCD.

80S ribosome was produced using a rabbit reticulocyte cell free expression system. 
80S ribosomes were crosslinked with the cleavable reagent DSSO [@kao_development_2011].

This ribosomal system for method development and optimization of CLMS 
workflows. There is a high-res EM structure of the complex which can be helpful 
in determining if the crosslinked are assigned correctly or not, [pdb:6HCJ](https://www.rcsb.org/structure/6hcj){target="_blank"}.

The example dataset included with Touchstone is from 80S sample analyzed using a stepped-HCD 
MS2 acquisition cycle (dataset #1). The modulefile categorizes the 80 or so ribosomal proteins to
either the large (60S) or small (40S) subunits.

![cryoEM structure of Rabbit 80S ribosome](https://cdn.rcsb.org/images/structures/6hcj_assembly-1.jpeg){width=30%}

```{r load_data, message=FALSE}
library(touchstone)
library(tidyverse)

pathToDemoFile <- system.file("extdata", "rRibo_DSSO_sthcd_scOut.txt", package="touchstone")
ribo <- readProspectorXLOutput(pathToDemoFile, minPepLen = 4, minIons = 0)

```

The crosslinking database search was run with Prospector program **Batch Tag**.
**Search Compare** is then used to process the search results and create a tab
delimited text file compatible with Touchstone processing. Touchstone expects 
unclassified search results with certain parameters included in the report. The
recommended Search Compare Paramters are inlcuded as an example file:

```{r search_compare_params}

# install.packages("jsonlite")
touchstone_example("tstoneMS2.4.json") %>% jsonlite::read_json()

```

You'll still need to render `README.Rmd` regularly, to keep `README.md` up-to-date. `devtools::build_readme()` is handy for this.

You can also embed plots, for example:

```{r pressure, echo = FALSE}
plot(pressure)
```

In that case, don't forget to commit and push the resulting figure files, so they display on GitHub and CRAN.


## References:
